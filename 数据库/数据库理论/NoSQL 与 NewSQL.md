# NoSQL

回顾 NoSQL 的发展：NoSQL 是在 Web 2.0 时代创建的。 互联网快速发展的时代也带来了互联网数据的爆炸式增长。 传统的关系数据库无法处理如此大量的数据，因此需要具有高可伸缩性的分布式数据库。 但是，基于传统的关系数据模型实现高可用性和可扩展的分布式数据库非常具有挑战性。 Internet 上大多数数据的数据模型很简单，不需要关系模型进行建模。 如果可以使用更简单的数据模型而不是关系模型来模拟数据，削弱事务和约束，并以高可用性和可伸缩性为目标，那么以这种方式设计的数据库将更好地满足业务需求。 这样的概念促进了 NoSQL 的发展。

NoSQL 数据库的英文定义为：Next Generation Databases mostly addressing some of the points: being non-relational, distributed, open-source and horizontally scalable.

# 行存储与列存储

[![image.png](https://i.postimg.cc/L8d2KF7R/image.png)](https://postimg.cc/Wh7QgCTf)

行存储，顾名思义即是将数据是按行存储，行存储的写入是一次性完成，消耗的时间比列存储少，并且能够保证数据的完整性；其插入与更新操作更为容易。但是其缺陷在于建立索引需要花费大量时间和资源，没有索引的话查询会产生大量的 I/O，导致效率低下；并且数据库必须被大量膨胀才能满足性能的需求。

列存储，数据按列存储，每一列单独存放，数据即是索引。只查询涉及的列，会大量降低系统 I/O,适合并发查询；数据类型一致，数据特征相似，能对数据进行高效压缩，并且非常适合做聚合操作。不过列存储缺乏数据完整性保证，写入效率低，因此不适合频繁的删除与更新操作。

如果你大部分时间都是关注整张表的内容，而不是单独某几列，并且所关注的内容是不需要通过任何聚集运算的，那么推荐使用行式存储。列式存储的话，比如你比较关注的都是某几列的内容，或者有频繁聚集需要的，通过聚集之后进行数据分析的表。

BigTable 及其他类似的数据库也提出了所谓宽表（Wide Column）模型的概念，目前很多半结构化或者结构化的数据都是基于该模型。这里以阿里云的表存储为例：

[![image.png](https://i.postimg.cc/zfzm8zkm/image.png)](https://postimg.cc/Js2YQWgK)

关系型数据库中往往是二维模型，并且包含了固定的 Schema；而上述宽表模型而包含了三个维度，除了标准的行、列之外，其还可以根据时间维度来存放数据，即根据不同的时间戳来保存不同的版本。

- Primary Key & Partition Key: 每行都有一个主键，由多个（1-4）列组成。 主键使用固定模式定义，主要用于唯一标识一行数据。 主键的第一列称为分区键，用于对表进行分区。 每个分区都分配给不同的机器进行维护。 在同一分区键中，提供了跨行事务。

- Attribute column: 除行中的主键列之外的所有列都是属性列。 属性列对应于多个值，不同的值对应于不同的版本，行可以存储无限数量的属性列。

我们还可以针对 Attribute Column 中的值定义不同的属性：

- 生存时间：可以为每个表定义生存时间。 例如，如果将生存时间配置为一个月，则将自动清除在一个月之前写入表数据的数据。 数据的写入时间由版本确定，版本通常由数据写入服务器端的服务器时间确定，也可以由应用程序指定。

- 最大版本号：可以为每个表定义每列中保存的最大版本数，用于控制列中的版本数；系统会自动清除超过最大版本数的数据。

# Time Series Model | 时间序列模型

时间序列模型是我们为消息数据场景创建的新数据模型。 它可以满足消息数据场景的特殊要求，保留消息顺序，海量消息存储和实时同步。

- Time series ID: 唯一标识时间序列。
- Time series Meta: 时间序列元数据，可以包含任何键值对属性。
- Message Sequence: 它包含时间序列中的所有消息。 消息按顺序存储，并根据写入顺序分配增量 ID。 消息序列可以携带无限数量的消息。 可以随机使用消息 ID 来定位序列内的消息，并且可以提供按升序或降序扫描。
- Message Entry: 它包含消息的详细内容，可以包含任何键值对。
