![default](https://user-images.githubusercontent.com/5803001/45228854-de88b400-b2f6-11e8-9ab0-d393ed19f21f.png)

InnoDB 是聚集索引，因为它的 B+树的叶结点包含了完整的数据记录。而 MyISAM 方式 B+树的叶结点只是存储了数据的地址，故称为非聚集索引。

# 索引类型

## Unique Index:唯一索引

UNIQUE 索引要求索引是唯一的。对于单列索引，要求该列所有数据都不相同，但允许有 NULL 值；对于多列的组合索引，要求这些列的组合是唯一的。UNIQUE 索引其本身既可以作为索引，实际中也可以用以产生数据约束，防止增加或者修改后产生相同数据，从而保证数据的完整性。

## Index:普通索引

普通索引，对数据没有约束要求，多行记录可以包含相同值。无论对于字符串索引，还是多列组合索引，都以及在查询语句中，都有个最左前缀的原则：

- 对于字符串类型，可以指定索引前缀长度(且对于 BLOB/TEXT 前缀长度参数是必须的)，在 InnoDB 表中其前缀长度最长是 767 bytes，且参数 M 是用 bytes 计量的。所以太长的字符串，建立 BTree 索引浪费比较大，这时候用[手动模拟 HASH 索引](undefined)是个方法，不过这种方式对字符串无法灵活的使用前缀方式查询(例如 LIKE 这类的操作)。

- 在建立多列索引的时候，必须按照从左到右的顺序使用全部或部分的索引列，才能充分的使用组合索引，比如：(col1, col2, col3)使用(col1)、(col1, col2)、(col1, col2, col3)有效。在查询语句中会一直向右匹配直到遇到范围查询(>,<,BETWEEN,LIKE)就停止匹配，其后的索引列将不会使用索引来优化查找了。

- 索引不是建立的越多、越长越好，因为索引除了占用空间之外，对后续数据库的增加、删除、修改都有额外的操作来更新索引，所以对索引列和字符串前缀长度，都参考选择性(Selectivity)这个指标来确定：选择性定义为不重复的索引值和数据总记录条数的比值，其选择性越高，那么索引的查询效率也越高，对于性别这种参数，建立索引根本没有意义。

# Primary Key:主键

主键必须唯一，不同的是不能有 Null。而且一个表只能有一个主键。有很多人认为主键是唯一索引的一种，其实是不准确的。主键也可以是组合索引，只要组合的每条结果是唯一的。这在某些场景非常实用，比如一个`多对多关系`中的枢纽表就非常适合使用复合主键。下图就是一个典型的用户权限功能的实现，用户和角色、角色和权限都是多对多的关系，需要枢纽表来记录他们之间的对应关系，而这些关系都是唯一的，所以这种枢纽表用复合主键非常合适。
在 InnoDB 内部，表数据是优化主键快速查询而排列分布的，其查找速度是最快的(相当于聚簇索引：该索引中键值的逻辑顺序决定了表中相应行的物理顺序)。即使表中没有适合做主键的列，也推荐采用一个自动增长的整数主键(代理键)，那么这个表在增加数据的时候是顺序存放的，而且后续在别的表参考该外键查询的时候也会得到优化。本身在设计表的时候，也建议常用的数据额不常用的数据分表存放以增加效率。
