# 分布式 ID

分布式节点各自独立生成全局唯一的 ID，有 Twitter 的 snowflake 机制、zookeeper 机制、微信的序列号方式以及 sequence 机制，不同的算法适应不同的场景，但我认为方法虽然很多，但原理只有两个，一种唯一性来自于节点本身的唯一标识，另一种唯一性来自于单点的唯一性。

1. 节点本身有一个唯一标识，依赖节点自身标识实现生成 ID 的全局唯一性。比如 zookeeper，每个 zookeeper 节点有一个预先设定好的 nodeId，nodeId 必须是一个正整数，zookeeper 节点生成的 id 都是本节点 nodeId 的同余类(比如集群数量是 5，当前节点的 nodeId=1 时，生成的 id=5\*n + 1)，由于本节点生成的 id 递增，不同节点生成的 id 集合互不相交，因此保证了 id 的全局唯一。但是这种场景下节点需要持久化当前偏移量，在崩溃恢复后保证 id 的唯一性，此外如果集群数量发生变化，可能导致 id 重复，需要额外的代价做到集群数量增加。
2. 节点本身无状态，由中心节点生成 id，这种方式对高可用和性能的挑战很高，但是可以生成全区唯一并且有序的序列，客户端不需要记录任何信息，每次需要 id 就向中心申请即可。微信的序列号就是这么做的，生成的 id 严格有序，并且做到高可用和高吞吐，具体参考http://www.infoq.com/cn/articles/wechat-serial-number-generator-architecture。
