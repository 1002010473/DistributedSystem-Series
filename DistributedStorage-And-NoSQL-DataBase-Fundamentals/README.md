# 分布式存储与 NoSQL 数据库基础

`Copyright © 2017 王下邀月熊`

![](https://www.confluent.io/wp-content/uploads/platform_chart_updated.png)

![](https://www.confluent.io/wp-content/uploads/streaming_platform_rev.png)

# 前言

首先要明确的是，没有完美的系统，任何一个系统的出现都是为了解决当时最主要的问题，但是会产生一些其他的小问题，跟药一样，能治病，但是一般都会有副作用。

那么完美的数据库系统什么样呢，我现在能想到以下几点： 1. 易用与灵活性：数据库可以理解自然语言，我跟它说我要存储什么样的数据，就存进去了，要查询什么样的数据，就给我取出来了，不需要我告诉它怎么存，怎么取 2. 扩展性：可以存储无限多的数据，不需要担心容量的问题 3. 高性能：性能非常强大，不管想存或取什么数据，瞬间就完成了 4. 高可用：数据存储之后，永远也不会丢，系统永远也不会挂掉，1 年 365 天，1 天 24 小时随叫随到 5. 并发与隔离性：数据库不仅可以满足我一个人，也可以满足所有人的同时读写，并且我们之间互不干扰

关系数据库之前的存储系统基本上一个条件也不满足

传统单机关系数据库一定程度上解决了问题 1、3 、 5，用户不需要知道数据是怎么存储的，行存储还是列存储或者其他的结构信息，查询的时候用 SQL 就可以了，不需要根据数据的存储结构编写特定的程序，大大简化了应用开发，性能也还可以。之所以说是一定程度上，是因为并没有完美的解决。SQL 虽然很简单，但要比自然语言复杂得多，更改表的 schema 也不是特别方便；性能的话对于复杂查询，优化器无能为力，可能会给出性能非常差的查询计划；并发与隔离性可以做到，但是要牺牲性能

Mysql Group Replication 帮助传统单机关系数据库解决了问题 4

如果数据量不大，这样用着也不错了。但是互联网导致了数据量的爆炸式增长，单机存储不下这么多数据了。所以才会出现了 Bigtable 等 NoSQL 分布式数据库，解决当时最主要的数据量暴增问题。这些系统一定程度上解决了问题 2、3 、 4。它想不想解决其他问题呢？肯定想，但是要解决这些问题，系统会变得更加复杂，需要更长的时间，但是系统需要快速上线啊，那么就先把最主要的问题解决了就好。隔离性就由业务部门自己去解决吧，这也导致了后来业务部门很多的抱怨。所以我觉得 NoSQL 在开发的时候是有很多妥协的，属于救火的产品，不可能成为未来的方向。

目前看来 OceanBase、TiDB 、 Spanner／F1 这些系统是能够解决上述问题最多的系统。 1. 支持 SQL 2. 数据被拆分成一个个 range，分散在不同的服务器中，通过增加服务器就可以一定程度上的线性扩容 4. 多副本，并且通过 paxos 或 raft 保证多副本之间的一致性 5. 通过 2PC，MVCC 支持不同隔离级别的事物

但是相比高端服务器上的单机数据库，性能会有些问题查询的延迟 (latency) 会比较高，网络是一个问题，比如分布式 join 就要用到网络，有人做过实验，在不改变现有查询引擎的情况下，单条查询随着服务器数量增多，性能不增反降，把网络换成 InfiniBand 效果也不好，后来重新设计了查询引擎，性能做到了递增。可以参考 High-Speed Query Processing over High-Speed Networks（http://www.vldb.org/pvldb/vol9/p228-roediger.pdf） 所以需要改变很多传统的做法，针对新硬件进行新的设计、优化，是可以大幅度提高性能的。

未来不敢说，单机数据库在很多场景下还是会有广泛应用的，NewSQL 最起码接下来的几年里都还有很大的发展潜力，而 NoSQL，分布式中间件等方案基本上就是明日黄花了。

NoSQL 数据库的英文定义为：Next Generation Databases mostly addressing some of the points: being non-relational, distributed, open-source and horizontally scalable.

* 硬件系统资源的自动化调度（CloudOS ）；

* 应用的并行化和分布化实现业务的自动扩展；

* 基于初始配置的自动化业务开通和业务部署；

* 基于前述能力，实现基于 SLA、QoS 等策略的自动化质量保障、故障隔离和故障自愈；

* 基于大数据智能驱动的系统自动化和自动调优。

## 参考

## 版权

![](https://parg.co/bDY) ![](https://parg.co/bDm)

笔者所有文章遵循 [知识共享 署名 - 非商业性使用 - 禁止演绎 4.0 国际许可协议](https://creativecommons.org/licenses/by-nc-nd/4.0/deed.zh)，欢迎转载，尊重版权。如果觉得本系列对你有所帮助，欢迎给我家布丁买点狗粮（支付宝扫码）~

![](https://github.com/wxyyxc1992/OSS/blob/master/2017/8/1/Buding.jpg?raw=true)

# 目录
